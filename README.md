# ESP32-S3 Touch LCD 2 GNSS LVGL Demo

## 项目简介

本项目基于 ESP32-S3-Touch-LCD-2 开发板，结合 LVGL 图形库，实现了GNSS（GPS）数据的采集、经纬度转换与实时显示。通过 UART 连接 GNSS 模块，解析 NMEA 协议数据，并将转换后的经纬度数据显示在 LCD 屏幕上。

## 主要功能
- 通过 UART2 采集 GNSS（GPS）模块数据
- 解析 NMEA 格式的 GNRMC 语句，获取定位状态、时间、原始经纬度等信息
- 将 NMEA 格式经纬度转换为标准 WGS84 十进制度数
- 使用 LVGL 在 LCD 屏幕上实时显示定位状态、时间、经纬度等信息
- 支持 IMU（QMI8658）数据的采集与显示

## 硬件连接说明
- UART2 用于 GNSS 模块通信
  - TXD (ESP32 GPIO43) 连接 GNSS RX
  - RXD (ESP32 GPIO44) 连接 GNSS TX
  - GND 连接 GNSS GND
  - 3.3V/5V 连接 GNSS VCC
- I2C 用于触摸屏通信
- SPI 用于 LCD 屏幕通信

## 主要代码结构

- `main.c`：主程序，包含以下核心部分：
  - UART 初始化与 GNSS 数据采集
  - NMEA 语句解析与经纬度转换
  - LVGL 初始化与 UI 创建
  - IMU 数据采集与显示
  - LVGL 定时任务与多线程保护

### LVGL 显示内容
- GPS status：定位状态（成功/搜索中）
- GPS time：UTC 时间（自动加8小时为北京时间）
- GPS latitude：当前纬度（WGS84十进制度数，保留6位小数）
- GPS longitude：当前经度（WGS84十进制度数，保留6位小数）
- IMU 加速度与陀螺仪数据

## 经纬度转换说明
- NMEA 格式（如 4000.420000）会被转换为十进制度数（如 40.007000）
- 显示时采用手动字符串格式化，保证在未开启浮点 printf 支持时依然正常显示

## 编译与运行
1. 使用 ESP-IDF 环境，配置好开发板型号和端口
2. `idf.py menuconfig` 检查 UART、SPI、I2C 引脚配置
3. 编译并烧录：
   ```
   idf.py build
   idf.py -p (端口号) flash
   ```
4. 上电后，LCD 屏幕将实时显示 GNSS 和 IMU 数据

## 注意事项
- 若 LVGL 屏幕经纬度显示为“f”或乱码，请检查 ESP-IDF printf 浮点支持是否开启，或采用本项目的手动字符串格式化方案
- GNSS 天线需置于空旷环境以保证定位成功

---

如需更多帮助或定制功能，请提交 issue 或联系作者。

---

# ESP32-S3 GNSS + IMU + LCD 显示程序

## 功能概述

这个程序整合了以下功能：
- **IMU传感器 (QMI8658)**: 显示加速度计和陀螺仪数据
- **GNSS模块 (L76X)**: 显示GPS定位信息，包括时间、坐标等
- **LCD触摸屏**: 显示所有传感器数据
- **坐标转换**: 支持GPS坐标到百度地图坐标的转换

## 硬件连接

### GNSS模块 (L76X) 连接
- **TX**: GPIO 17 (连接到ESP32的RX)
- **RX**: GPIO 16 (连接到ESP32的TX)
- **VCC**: 3.3V
- **GND**: GND

### 其他硬件
- **LCD**: SPI接口 (已配置)
- **触摸屏**: I2C接口 (已配置)
- **IMU**: I2C接口 (已配置)

## 显示内容

程序会在LCD屏幕上显示以下信息：

### IMU数据 (每100ms更新)
- accel_x: X轴加速度
- accel_y: Y轴加速度  
- accel_z: Z轴加速度
- gyro_x: X轴角速度
- gyro_y: Y轴角速度
- gyro_z: Z轴角速度

### GNSS数据 (每1秒更新)
- GPS状态: 定位成功/定位失败 (绿色/红色显示)
- GPS时间: 当前GPS时间 (HH:MM:SS)
- GPS纬度: 原始GPS纬度坐标
- GPS经度: 原始GPS经度坐标
- 百度纬度: 转换后的百度地图纬度
- 百度经度: 转换后的百度地图经度

## 坐标转换

程序支持以下坐标转换：
1. **GPS原始坐标** (WGS-84) → **GCJ-02** (火星坐标系)
2. **GCJ-02** → **BD-09** (百度坐标系)

## 使用方法

1. 确保硬件连接正确
2. 编译并烧录程序到ESP32-S3
3. 将GNSS模块放置在室外开阔位置
4. 等待GPS定位 (通常需要1-5分钟)
5. 观察LCD屏幕上的数据更新

## 注意事项

- GNSS模块需要室外开阔环境才能获得良好的定位效果
- 首次定位可能需要较长时间 (冷启动)
- 坐标转换仅适用于中国地区
- 程序使用UART2与GNSS模块通信

## 技术细节

- **GNSS波特率**: 115200
- **UART配置**: 8数据位，1停止位，无奇偶校验
- **缓冲区大小**: 1600字节
- **更新频率**: IMU 10Hz, GNSS 1Hz

## 故障排除

1. **无法定位**: 检查天线连接，确保在室外开阔位置
2. **数据不更新**: 检查UART连接，确认波特率设置
3. **显示异常**: 检查LCD和触摸屏连接
4. **IMU数据异常**: 检查I2C连接和电源供应
